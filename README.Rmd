---
output: github_document
always_allow_html: true
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  comment = "#",
  collapse = TRUE,
  fig.path = "man/figures/README-",
  fig.width = 8,
  fig.height = 5
  )
```

# sentopics

<!-- badges: start -->
[![R-CMD-check](https://github.com/odelmarcelle/sentopics/workflows/R-CMD-check/badge.svg)](https://github.com/odelmarcelle/sentopics/actions)
[![Codecov test coverage](https://codecov.io/gh/odelmarcelle/sentopics/branch/master/graph/badge.svg?token=V6M82L4ZCX)](https://codecov.io/gh/odelmarcelle/sentopics?branch=master)
<!-- badges: end -->

## Installation

`sentopics` currently requires the development version of data.table (1.14.3 or greater).

``` {r eval = FALSE}
if (!requireNamespace("data.table", quietly = TRUE)) install.packages("data.table")
data.table::update.dev.pkg()
devtools::install_github("odelmarcelle/sentopics") 
```


## Basic usage

Using a sample of speeches from the European Central Bank, a LDA model is easily created from a list of tokenized texts. See https://quanteda.io for details on `tokens` input objects and pre-processing functions.

``` {r}
library(sentopics)
print(ECB_speeches, 2)
set.seed(12)
lda <- LDA(ECB_speeches, K = 4)
lda <- grow(lda, 100)
lda
```

There are various way to extract results from the model: it is either possible to directly access the estimated mixtures from the `lda` object or to use some helper functions.

```{r paged.print=FALSE}
head(lda$theta) # The document-topic distributions
head(melt(lda, include_docvars = TRUE)) # The document-topic in a 'long' format & with meta-data
topWords(lda, output = "matrix") # The most probable words per topic
```

Two visualization are also implemented: `plot_topWords()` display the most probable words and `plot()` summarize the topic proportions and their top words.
```{r plot-lda-show, eval = FALSE}
plot(lda)
```
```{r plot-lda, warning=FALSE, fig.align='center', fig.width = 5, echo = FALSE}
plot(lda) |> plotly::layout(width = 500, height = 500)
```



After properly incorporating date and sentiment medata data (if they are not already present in the `tokens` input), time series functions allows to study the evolution of topic proportions and related sentiment.
```{r series, message=FALSE, out.width="100%"}
sentopics_date(lda) <- ECB_speeches$.date
sentopics_sentiment(lda) <- ECB_speeches$.sentiment
head(proportion_topics(lda, period = "month"))
plot_sentiment_breakdown(lda, period = "day", rolling_window = 90)
```